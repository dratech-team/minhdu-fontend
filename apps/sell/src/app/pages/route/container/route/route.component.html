<div class=' h3 mt-3 ml-5 '>
  Danh sách tuyến đường
</div>
<div class='d-flex justify-content-between mt-3  ml-5'>
  <button (click)='add()' class='btn btn-primary font-lg '>Thêm Tuyến đường</button>
  <a (click)='printRouter()' target='_blank' download='data.xlsx'
    class='btn text-white btn-primary font-lg mr-3'>Xuất</a>
</div>
<ngx-skeleton-loader *ngIf='!(loaded$ | async); else route' count='20' appearance='line'></ngx-skeleton-loader>
<ng-template #route>
  <div class='table-scroll mx-auto border-top my-5' style='width: 96%' infiniteScroll [alwaysCallback]='true'
    [infiniteScrollDistance]='1' [infiniteScrollThrottle]='10' [scrollWindow]='false' (scrolled)='onScroll()'>
    <table [formGroup]='formGroup'>
      <thead>
        <tr>
          <th style='min-width: 200px'>
            <div>Tên Tuyến đường</div>
            <input formControlName='name' class='form-control' type='text' placeholder=''>
          </th>
          <th>
            <div class=''>Ngày bắt đầu</div>
            <input formControlName='startedAt' class=' form-control' type='date'>
          </th>
          <th>
            <div class=''>Ngày Kết thúc</div>
            <input formControlName='endedAt' class='form-control' type='date'>
          </th>
          <th>
            <div class=''>Tên Tài xế</div>
            <input formControlName='driver' class=' form-control' type='text' placeholder='Trần Gia Hiệu'>
          </th>
          <th>
            <div class=''>Khách hàng</div>
            <input formControlName='driver' class=' form-control' type='text' placeholder='Trần Gia Hiệu'>
          </th>
          <th>
            <div class=''>Biển số xe</div>
            <input formControlName='bsx' class='form-control' type='text' placeholder='77G1-55555'>
          </th>
          <th>
            <div>Nhà xe</div>
            <input type='text' class='form-control' placeholder='Nhập nhà xe' formControlName='garage'>
          </th>
          <th>
            <div class=''>Trạng thái chuyến xe</div>
            <select class='select border-top' style='width: 100%' matNativeControl required
              formControlName='statusRoute'>
              <option value='{{statusRoute.RUNNING}}'>Đang chạy</option>
              <option value='{{statusRoute.COMPLETE}}'>Hoàn thành</option>
              <option value=''>Tất cả</option>
            </select>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor='let route of routes' (click)='detailRoute(route.id)'
          (contextmenu)='child.onContextMenu($event, route)' class='pointer'>
          <th>{{route?.name || 'Chưa cập nhật'}}</th>
          <th>
            {{(route?.startedAt | date:'dd/MM/yyyy') || 'Chưa cập nhật'}}
          </th>
          <th>
            {{(route?.endedAt | date:'dd/MM/yyyy') || 'Chưa cập nhật'}}
          </th>
          <th>{{route?.driver || route?.employee?.lastName}}</th>
          <th>
            <div class=' d-flex align-items-center justify-content-center pointer ' [ngClass]='{
              "border-top": route.orders.length > 1 && index  !== 0
              }' *ngFor='let order of route.orders; let index = index'>
              {{order.customer.lastName}}
            </div>
          </th>
          <th>{{route?.bsx || 'Chưa cập nhật'}}</th>
          <th>{{route?.garage || 'Chưa cập nhật'}}</th>
          <th>{{route.endedAt && route.endedAt.getTime() < today ? 'Hoàn thành' : 'Đang chạy' }}
          </th>
        </tr>
        <tr *ngIf='!routes || routes.length === 0' style='height: 50vh'>
          <td colspan='10' class='position-relative font-weight-bold font-lg'>
            <span style='position: absolute; top:40%; left: 40% '>
              Hiện tại chưa có đơn Tuyến đường nào
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-template>
<app-mouse-right #child (onAdd)='add()' [items]="[ItemContextMenu.ENDED_AT]" (onDel)='deleteRoute($event)'
  (onDetail)='detailRoute($event)' (onEnd)="onEnd($event)">
</app-mouse-right>