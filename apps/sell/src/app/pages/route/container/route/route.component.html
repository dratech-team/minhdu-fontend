<div class=' h3 mt-3 ml-5 '>
  Danh sách tuyến đường
</div>
<div class='d-flex justify-content-between mt-3  ml-5'>
  <button (click)='add()' class='btn btn-primary font-lg '>Thêm Tuyến đường</button>
  <a (click)='printRouter()' target='_blank' download='data.xlsx'
     class='btn text-white btn-primary font-lg mr-3'>Xuất</a>
</div>
<div class='table-scroll mx-auto border-top my-5' style='width: 96%' infiniteScroll [alwaysCallback]='true'
     [infiniteScrollDistance]='1' [infiniteScrollThrottle]='10' [scrollWindow]='false' (scrolled)='onScroll()'>
  <table matSort
         (matSortChange)='sortRoute()'
         [formGroup]='formGroup'>
    <thead>
    <tr>
      <th style='min-width: 200px'>
        <div class='d-flex justify-content-center' mat-sort-header='{{sortRouteEnum.NAME}}'>Tên Tuyến đường</div>
        <input formControlName='name' class='form-control' type='search' placeholder=''>
      </th>
      <th>
        <div class='d-flex justify-content-center' mat-sort-header='{{sortRouteEnum.START}}'>Ngày bắt đầu</div>
        <input formControlName='startedAt' class=' form-control' type='date'>
      </th>
      <th>
        <div class='d-flex justify-content-center' mat-sort-header='{{sortRouteEnum.END}}'>Ngày Kết thúc</div>
        <input formControlName='endedAt' class='form-control' type='date'>
      </th>
      <th>
        <div class='d-flex justify-content-center' mat-sort-header='{{sortRouteEnum.DRIVER}}'>Tên Tài xế</div>
        <input formControlName='driver' class=' form-control' type='search' placeholder='Trần Gia Hiệu'>
      </th>
      <th>
        <div class='d-flex justify-content-center' mat-sort-header='{{sortRouteEnum.CUSTOMER}}'>Khách hàng</div>
        <input formControlName='driver' class=' form-control' type='search' placeholder='Trần Gia Hiệu'>
      </th>
      <th>
        <div class='d-flex justify-content-center' mat-sort-header='{{sortRouteEnum.BSX}}'>Biển số xe</div>
        <input formControlName='bsx' class='form-control' type='search' placeholder='77G1-55555'>
      </th>
      <th>
        <div class='d-flex justify-content-center' mat-sort-header='{{sortRouteEnum.GARAGE}}'>Nhà xe</div>
        <input type='search' class='form-control' placeholder='Nhập nhà xe' formControlName='garage'>
      </th>
      <th>
        <div class='d-flex justify-content-center'>Trạng thái chuyến xe</div>
        <select class='select border-top' style='width: 100%' matNativeControl required
                formControlName='status'>
          <option value='0'>Đang chạy</option>
          <option value='1'>Hoàn thành</option>
          <option value='-1'>Tất cả</option>
        </select>
      </th>
    </tr>
    </thead>
    <tbody>
    <tr *ngIf='(loading$ | async); else route'>
      <th colSpan='100'>
        <ngx-skeleton-loader count='10' appearance='line'></ngx-skeleton-loader>
      </th>
    </tr>
    <ng-template #route>
      <tr
        *ngFor='let route of routes'
        (click)='detailRoute(route.id, false)'
        (contextmenu)='child.onContextMenu($event, route)' class='pointer'
      >
        <th>{{route?.name || 'Chưa cập nhật'}}</th>
        <th>
          {{(route?.startedAt | date:'dd/MM/yyyy') || 'Chưa cập nhật'}}
        </th>
        <th>
          {{(route?.endedAt | date:'dd/MM/yyyy') || 'Chưa cập nhật'}}
        </th>
        <th>{{route?.driver || route?.employee?.lastName}}</th>
        <th>
          <div class=' d-flex align-items-center justify-content-center pointer ' [ngClass]='{
              "border-top": route.orders.length > 1 && index  !== 0
              }' *ngFor='let order of route.orders; let index = index'>
            {{order.customer.lastName}}
          </div>
        </th>
        <th>{{route?.bsx || 'Chưa cập nhật'}}</th>
        <th>{{route?.garage || 'Chưa cập nhật'}}</th>
        <th>{{route.endedAt && route.endedAt.getTime() < today ? 'Hoàn thành' : 'Đang chạy' }}
        </th>
      </tr>
      <tr *ngIf='!routes || routes.length === 0' style='height: 50vh'>
        <td colspan='10' class='position-relative font-weight-bold font-lg'>
            <span style='position: absolute; top:40%; left: 40% '>
              Hiện tại chưa có đơn Tuyến đường nào
            </span>
        </td>
      </tr>
    </ng-template>
    </tbody>
  </table>
</div>
<app-mouse-right
  #child
  [items]='[ItemContextMenu.ENDED_AT]'
  (onAdd)='add()'
  (onDel)='deleteRoute($event)'
  (onUpdate)='detailRoute($event.id, true)'
  (onEnd)='onEnd($event)'
>
</app-mouse-right>
