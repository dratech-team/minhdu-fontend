<div class="d-flex">
  <div class='d-flex flex-column ml-3 border p-2' style='height: 80vh; width:280px; overflow-y: scroll'>
    <nz-collapse>
      <nz-collapse-panel
        nzHeader='Tìm kiếm'
        nzActive='true'>
        <div [formGroup]='formGroup'>
          <input nz-input class='form-control' type='search' formControlName='search'>
        </div>
      </nz-collapse-panel>
    </nz-collapse>
    <div class="mt-2">
      <minhdu-fontend-collapse-radios
        [formGroup]="formGroup" header="Giới tính"
        [controlName]="'gender'"
        [active]="true"
        [radios]="radiosGender"
      >
      </minhdu-fontend-collapse-radios>
    </div>
    <div class="mt-2">
      <minhdu-fontend-collapse-radios
        [formGroup]="formGroup" header="Tiềm năng"
        [controlName]="'isPotential'"
        [active]="true"
        [radios]="radiosPotential"
      >
      </minhdu-fontend-collapse-radios>
    </div>
    <!--    <div class='mt-2'>-->
    <!--      <minhdu-fontend-collapse-datepicker [title]="'Ngày hẹn giao'"-->
    <!--                                          (onPicker)='onPickDeliveryDay($event)'></minhdu-fontend-collapse-datepicker>-->
    <!--    </div>-->
    <!--    <div class='mt-2'>-->
    <!--      <minhdu-fontend-collapse-datepicker title='Ngày tạo'-->
    <!--                                          (onPicker)='onPickCreatedAt($event)'></minhdu-fontend-collapse-datepicker>-->
    <!--    </div>-->
    <!--    <div class="mt-2">-->
    <!--      <minhdu-fontend-collapse-status [formGroup]="formGroup" header="Trạng thái đơn hàng" [radios]="radios">-->
    <!--      </minhdu-fontend-collapse-status>-->
    <!--    </div>-->
  </div>
  <div style="width: 76vw">
    <div class="d-flex">
      <div class='row h3 ml-3 mt-3'>Hồ sơ khách hàng</div>
      <div class='ml-3 d-flex justify-content-between ' style='width: 100%'>
        <button (click)='add()' class='btn btn-primary font-lg'>Thêm</button>
        <button (click)='printCustomer()' class='btn btn-primary font-lg mr-5 '>Xuất</button>
      </div>
    </div>
    <div class='table-scroll mx-auto my-5' style='width: 96%;' infiniteScroll [infiniteScrollDistance]='0.1'
         [infiniteScrollThrottle]='10' [scrollWindow]='false' [alwaysCallback]='true' (scrolled)='onScroll()'>
      <table matSort
             (matSortChange)='sortCustomer()'
             [formGroup]='formGroup' style='width: 2400px'>
        <thead>
        <tr>
          <th style='min-width: 300px'>
            <div class="d-flex justify-content-center" mat-sort-header='{{sortCustomerEnum.NAME}}'>Tên khách hàng</div>
            <input class='form-control' type='search' placeholder='Trần Văn A' formControlName='name'>
          </th>
          <th style='width: 150px'>
            <div class="d-flex justify-content-center align-items-center">Số điện thoại</div>
            <input formControlName='phone' class='form-control' type='tel' pattern='[0-9]{3} [0-9]{3} [0-9]{4}'
                   maxlength='12'>
          </th>
          <th style='width: 150px'>
            <div class="d-flex justify-content-center align-items-center">Ngày sinh</div>
            <input formControlName='birthDay' class='form-control' type='date'>
          </th>
          <th>
            <div class="d-flex justify-content-center" mat-sort-header='{{sortCustomerEnum.GENDER}}'>Giới tính</div>
            <mat-select
              class='select border-top'
              style='width: 100%'
              matNativeControl
              required
              formControlName='gender'
            >
              <mat-option *ngFor='let item of GenderTypes' [value]='item.type'>{{item.name}}</mat-option>
            </mat-select>
          </th>
          <th style='width: 150px'>
            <div class="d-flex justify-content-center" mat-sort-header='{{sortCustomerEnum.IS_POTENTIAL}}'>Tiềm năng
            </div>
          </th>
          <!--        <th style='width: 200px'>-->
          <!--          <div class=''>Quốc gia</div>-->
          <!--          <input formControlName='nationId' class='form-control' type='text'>-->
          <!--        </th>-->
          <th>
            <div class="d-flex justify-content-center" mat-sort-header='{{sortCustomerEnum.RESOURCE}}'>Nguồn khách hàng
            </div>
            <mat-select class='select border-top' style='width: 100%' matNativeControl required
                        formControlName='resource'>
              <mat-option *ngFor='let item of resourceTypes' [value]='item.type'>{{item.name}}</mat-option>
            </mat-select>
          </th>
          <th>
            <div class="d-flex justify-content-center" mat-sort-header='{{sortCustomerEnum.CUSTOMER_TYPE}}'>Loại khách
              hàng
            </div>
            <mat-select class='select border-top' style='width: 100%' matNativeControl required
                        formControlName='customerType'>
              <mat-option *ngFor='let item of CustomerTypes' [value]='item?.type'>{{item.name}}</mat-option>
            </mat-select>
          </th>
          <th>
            <div class="d-flex justify-content-center align-items-center">Email</div>
            <input formControlName='email' class='form-control' type='text'>
          </th>
          <th>
            <div class="d-flex justify-content-center align-items-center">Địa chỉ</div>
            <input formControlName='address' class='form-control' type='search'>
          </th>
          <th>
            <div class="d-flex justify-content-center align-items-center">Chú thích</div>
            <input formControlName='note' class='form-control' type='search'>
          </th>
        </tr>
        </thead>
        <tbody *ngIf='(customers$ | async) as customers'>
        <tr *ngIf='(loading$ | async); else customerTable'>
          <th colSpan="100">
            <ngx-skeleton-loader count='10' appearance='line'></ngx-skeleton-loader>
          </th>
        </tr>
        <ng-template #customerTable>
          <tr
            class='pointer'
            *ngFor='let customer of customers; let i = index'
            (click)='readAndUpdate(customer, false)'
            (contextmenu)='child.onContextMenu($event, customer)'
          >
            <th [ngClass]='{"odd": i % 2 === 0, "even": i % 2 !== 0 }'>{{customer?.lastName}} </th>
            <th>{{customer?.phone || 'Chưa cập nhật'}}</th>
            <th>{{customer?.birthday | date:'dd/MM/yyyy'}}</th>
            <th> {{customer?.gender === 'MALE' ? 'Nam' : customer?.gender === 'FEMALE' ? 'Nữ' : 'Chưa cập nhật'}}</th>
            <th>
              <input type='checkbox' disabled [checked]='customer.isPotential'>
            </th>
            <!--        <th>-->
            <!--          {{customer?.ward?.district?.province?.nation?.name ? customer?.ward?.district?.province?.nation?.name :-->
            <!--          'Chưa cập nhật'}}-->
            <!--        </th>-->
            <th>{{ customer.resource | transform: resourceTypes}}</th>
            <th> {{customer?.type === customerType.AGENCY ? 'Đại lý' : customer?.type === customerType.RETAIL ? 'Khách lẻ' : 'Chưa cập nhật'}}</th>
            <th>{{customer?.email || 'Chưa cập nhật'}}</th>
            <th>{{(customer?.address || '') + ' ' + (customer.ward?.name || '') + ' ' + (customer.district?.name || '') + ' ' + customer.province.name}}</th>
            <th> {{customer?.note || 'Chưa cập nhật'}}</th>
          </tr>
          <tr *ngIf='!customers || customers.length === 0' style='height:60vh; '>
            <td colspan='15' class='position-relative font-weight-bold'>
            <span style='position: absolute; top: 40%; left: 40% ; font-size: 23px'>
              Hiện chưa có Khách hàng nào!
            </span>
            </td>
          </tr>
        </ng-template>
        </tbody>
      </table>
    </div>
  </div>
</div>


<app-mouse-right
  #child
  [items]='[ItemContextMenu.PAYMENT, ItemContextMenu.ADD_ORDER]'
  (onAddOrder)='addOrder($event)'
  (onAdd)='add()'
  (onDel)='deleteCustomer($event)'
  (onPay)='payment($event)'
  (onUpdate)='readAndUpdate($event, true)'
>
</app-mouse-right>
