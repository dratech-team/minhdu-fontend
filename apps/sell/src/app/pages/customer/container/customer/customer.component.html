<div class="d-flex">
  <div class='d-flex flex-column ml-3 border p-2' style='height: 80vh; width:280px; overflow-y: scroll'>
    <nz-collapse>
      <nz-collapse-panel
        nzHeader='Tìm kiếm'
        nzActive='true'>
        <div [formGroup]='formGroup'>
          <input nz-input class='form-control' type='search' formControlName='search'>
        </div>
      </nz-collapse-panel>
    </nz-collapse>
    <div class="mt-2">
      <minhdu-fontend-collapse-radios
        [formGroup]="formGroup" header="Giới tính"
        [controlName]="'gender'"
        [active]="true"
        [radios]="radiosGender"
      >
      </minhdu-fontend-collapse-radios>
    </div>
    <div class="mt-2">
      <minhdu-fontend-collapse-radios
        [formGroup]="formGroup" header="Tiềm năng"
        [controlName]="'isPotential'"
        [active]="true"
        [radios]="potentialsConstant"
      >
      </minhdu-fontend-collapse-radios>
    </div>
    <div class="mt-2">
      <minhdu-fontend-collapse-radios
        [formGroup]="formGroup" header="Nguồn khác hàng"
        [controlName]="'resource'"
        [active]="true"
        [radios]="resourcesConstant"
      >
      </minhdu-fontend-collapse-radios>
    </div>
    <div class="mt-2">
      <minhdu-fontend-collapse-radios
        [formGroup]="formGroup" header="Loại khách hàng"
        [controlName]="'customerType'"
        [active]="true"
        [radios]="customerConstant"
      >
      </minhdu-fontend-collapse-radios>
    </div>
  </div>
  <div class="ml-3" style="width: 76vw">
    <div class="d-flex justify-content-between mt-3">
      <div class='h3'>Hồ sơ khách hàng</div>
      <div class='ml-3 d-flex'>
        <button (click)='add()' class="mr-2" nz-button nzType="primary">Thêm</button>
        <button (click)='printCustomer()' nz-button nzType="default">Xuất</button>
      </div>
    </div>
    <div class="mt-3">
      <div class="mb-1"><span class="font-weight-bold">Tổng khách hàng:</span> {{total$|async}}</div>
      <nz-table #tableCustomer
                nzSize="middle"
                [nzData]="(customers$|async)"
                [nzScroll]="{ x: '2500px',y: '70vh'}"
                [nzShowPagination]='true'
                (nzPageIndexChange)="onPagination($event)"
                [nzPageSize]="pageSizeTable"
                [nzLoading]="loading$|async"
      >
        <thead>
        <tr>
          <th nzLeft nzWidth='60px'>
            STT
          </th>
          <th nzLeft [nzSortFn]='true' (nzSortOrderChange)="onSort({orderBy: sortCustomerEnum.NAME, orderType:$event})">
            Tên khách hàng
          </th>
          <th>
            Số điện thoại
          </th>
          <th>
            Ngày sinh
          </th>
          <th [nzSortFn]='true' (nzSortOrderChange)="onSort({orderBy: sortCustomerEnum.GENDER, orderType:$event})">
            Giới tính
          </th>
          <th [nzSortFn]='true'
              (nzSortOrderChange)="onSort({orderBy: sortCustomerEnum.IS_POTENTIAL, orderType:$event})">
            Tiềm năng
          </th>
          <!--        <th style='width: 200px'>-->
          <!--          <div class=''>Quốc gia</div>-->
          <!--          <input formControlName='nationId' class='form-control' type='text'>-->
          <!--        </th>-->
          <th [nzSortFn]='true' (nzSortOrderChange)="onSort({orderBy: sortCustomerEnum.RESOURCE, orderType:$event})">
            Nguồn khách hàng
          </th>
          <th [nzSortFn]='true'
              (nzSortOrderChange)="onSort({orderBy: sortCustomerEnum.CUSTOMER_TYPE, orderType:$event})">
            Loại khách hàng
          </th>
          <th>
            Email
          </th>
          <th>
            Địa chỉ
          </th>
          <th>
            Chú thích
          </th>
        </tr>
        </thead>
        <tbody>
        <ng-template ngFor let-customer [ngForOf]='tableCustomer.data' let-i='index'>
          <tr
            class='pointer'
            (click)='readAndUpdate(customer, false)'
            (contextmenu)='child.onContextMenu($event, customer)'
          >
            <td nzLeft>{{i + 1}}</td>
            <td nzLeft>{{customer?.lastName}} </td>
            <td>{{customer?.phone || 'Chưa cập nhật'}}</td>
            <td>{{customer?.birthday ? (customer.birthday | date:'dd/MM/yyyy') : 'Chưa cập nhật'}}</td>
            <td> {{customer?.gender === 'MALE' ? 'Nam' : customer?.gender === 'FEMALE' ? 'Nữ' : 'Chưa cập nhật'}}</td>
            <td>
              <input type='checkbox' disabled [checked]='customer.isPotential'>
            </td>
            <!--        <th>-->
            <!--          {{customer?.ward?.district?.province?.nation?.name ? customer?.ward?.district?.province?.nation?.name :-->
            <!--          'Chưa cập nhật'}}-->
            <!--        </th>-->
            <td>{{ customer?.resource | transform: resourcesConstant}}</td>
            <td> {{customer?.type === customerType.AGENCY ? 'Đại lý' : customer?.type === customerType.RETAIL ? 'Khách lẻ' : 'Chưa cập nhật'}}</td>
            <td>{{customer?.email || 'Chưa cập nhật'}}</td>
            <td>{{(customer?.address || '') + ' ' + (customer.ward?.name || '') + ' ' + (customer.district?.name || '') + ' ' + customer.province.name}}</td>
            <td> {{customer?.note || 'Chưa cập nhật'}}</td>
          </tr>
        </ng-template>
        </tbody>
      </nz-table>
    </div>
  </div>
</div>


<app-mouse-right
  #child
  [items]='[ItemContextMenu.PAYMENT, ItemContextMenu.ADD_ORDER]'
  (onAddOrder)='addOrder($event)'
  (onAdd)='add()'
  (onDel)='deleteCustomer($event)'
  (onPay)='payment($event)'
  (onUpdate)='readAndUpdate($event, true)'
>
</app-mouse-right>
