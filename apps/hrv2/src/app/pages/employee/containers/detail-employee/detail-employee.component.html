<div class='animated fadeIn container mb-3  '>
  <div class='row col-12 d-flex justify-content-between' *ngIf='(employee$ | async)  as employee'>
    <div class='row mt-5 mr-5'>
      <div class=' main-title  mr-5'>
        Thông tin nhân viên
      </div>
      <div class=' justify-content-center not-print'>
        <img
          class='rounded-circle row'
          alt='50x50'
          src='{{employee?.avt}}'
          data-holder-rendered='true'
          height='160px'
        />
        <button
          class='row btn d-flex justify-content-between align-items-center mt-2  shadow-sm p-1 mb-3 bg-white rounded not-print'>
          <img src='../../../../../assets/img/share/person-circle.svg' alt='avatar'>
          <span class='ml-2' style='color: #80828B;'>
                  Đổi avatar
            </span>
        </button>
        <button (click)='deleteEmployee(employee, employee?.leftAt)'
                class='row btn shadow-none p-2 mb-3 bg-light rounded'>
              <span style='text-align: center; font-weight: 600;font-size: 16px;line-height: 19px; width:240px;'>
                 {{employee.leftAt ? 'Khôi phục' : 'Xóa nhân viên' }}
              </span>
        </button>
      </div>
    </div>
    <div class="not-print">
      <button (click)='historySalary(employee )'
              class='mt-5 btn d-flex d-flex justify-content-center  align-items-center mr-3'
              style='border: solid 1px #4B3880'>
        <img class='mr-1' src='../../../../../assets/img/share/arrow-counterclockwise.svg' alt='history'><span>xem lịch sử lương</span>
      </button>
    </div>
  </div>
  <div class='row mt-3' style='color:#80828B' *ngIf='(employee$ | async)  as employee'>
    <div class='col-12'>
      <div class='row d-flex align-items-center not-print'>
        <div class='col-2 align-items-center title-table'>Thông tin chung</div>
        <button
          *ngIf='!employee.leftAt'
          data-toggle='tooltip'
          data-placement='top'
          title=' chỉnh sửa '
          class='edit animated not-print'
          (click)='updateEmployee(employee)'>
          <img style='height: 15px;' src='../../../../../assets/img/share/pencil-fill.svg' alt='edit icon'>
        </button>
      </div>
      <div class='row mt-3'>
        <div class='col-6  form-group'>
          <div class='row ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Họ và tên :</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail' style=' color: #3C3B54'>
             {{employee.lastName}}
            </span>
            </div>
          </div>
          <div class='row ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Giới tính :</span>
            </div>
            <div class='col-md-8 d-flex flex-row'>
              {{employee.gender|transform:genderTypeConstant}}
            </div>
          </div>
          <div class='row ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Ngày sinh :</span>
            </div>
            <div class='col-md-8 py-2'>
              <span>
                  {{employee.birthday|date:'dd/MM/yyyy'}}
                </span>
            </div>
          </div>
          <div class='row ml-1  align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span> Nguyên quán :</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail' style='color: #3C3B54'>
              {{employee.birthplace === null ? 'Chưa cập nhật' : employee.birthplace }}
            </span>
            </div>
          </div>
          <div class=' row ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>CMND/CCCD:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail'>
               {{employee.identify}}
            </span>
            </div>
          </div>
          <div class=' row ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Ngày cấp:</span>
            </div>
            <div class='col-md-8 py-2'>
              <span class='contain-detail'>
                {{employee.idCardAt|date:'dd/MM/yyy'}}
                </span>
            </div>
          </div>
          <div class=' row ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Nơi cấp:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail'>
              {{employee.issuedBy}}
            </span>
            </div>
          </div>
          <div class='row ml-1  align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span> Dân tộc :</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail'>
              {{employee?.ethnicity ? employee.ethnicity : 'Chưa cập nhật'}}
            </span>
            </div>
          </div>
          <div class='row  ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Ngày công chuẩn :</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail'>
               {{employee.workday}}
            </span>
            </div>
          </div>
          <div class='row ml-1  align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Công thức lương:</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail'>
              {{employee.recipeType|transform:recipeConstant}}
            </span>
            </div>
          </div>
          <div class='row ml-1  align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Loại lương:</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail'>
            {{employee.isFlatSalary}}
            </span>
            </div>
          </div>
          <div class='row  ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Ngày vào làm :</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail'>
               {{employee?.createdAt ? (employee.createdAt|date:'dd/MM/yyyy') : 'Chưa cập nhật'}}
            </span>
            </div>
          </div>
          <div class='row  ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Ngày làm chính thức:</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail'>
               {{employee?.workedAt ? (employee.workedAt |date:'dd/MM/yyyy') : 'Chưa cập nhật'}}
            </span>
            </div>
          </div>
          <div class='row  ml-1 align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Ngày nghỉ việc:</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail'>
               {{employee.leftAt ? (employee.leftAt |date:'dd/MM/yyyy') : 'Chưa cập nhật' }}
            </span>
            </div>
          </div>
        </div>
        <div class='col-6  form-group'>
          <div class='row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Đơn vị :</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail' style='color: #3C3B54'>
              {{employee?.branch?.name}}
            </span>
            </div>

          </div>
          <div class='row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Chức vụ :</span>
            </div>
            <div class='col py-2 '>
              <div class='p-1 px-3 '
                   style='font-weight: 600; font-size: 16px; border: solid 1px #63c2de;width: fit-content'>
                {{employee.position.name}}
              </div>
            </div>
          </div>
          <div class='row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Địa chỉ :</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail' style='color: #3C3B54'>
              {{employee.address}}
            </span>
            </div>
          </div>
          <div class='row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Phường xã :</span>
            </div>
            <div class='col py-2 '>
              <div class='contain-detail'>
                <div>{{employee?.ward?.name}}</div>
              </div>
            </div>
          </div>
          <div class='row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Quận huyện :</span>
            </div>
            <div class='col py-2 '>
              <div class='contain-detail'>
                {{employee?.ward?.district?.name}}
              </div>
            </div>
          </div>
          <div class='row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Tỉnh thành:</span>
            </div>
            <div class=' col py-2 '>
              <div class='contain-detail'>
                {{employee?.ward?.district?.province?.name}}
              </div>
            </div>
          </div>
          <div class='row  align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Tôn giáo :</span>
            </div>
            <div class='col-md-8 py-2 '>
            <span class='contain-detail'>
               {{employee.religion === null ? 'Chưa cập nhật' : employee.religion }}
            </span>
            </div>
          </div>
          <div class='row  align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Thuộc diện hợp đồng :</span>
            </div>
            <div class='col-md-8 py-2 '>
              <div style='width: fit-content; height: fit-content'
                   (click)='updateContract(employee)'
              >
                <input

                  style='pointer-events: none'
                  disabled
                  type='checkbox'
                  [checked]='employee?.contracts?.length !==0'>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
    <div class='col-12 mt-3'>
      <div class=' d-flex align-items-center'>
        <div class='align-items-center main-title ml-2 mr-4'>Thông tin liên hệ</div>
      </div>
      <div class='row pl-3'>
        <div class='col-6  form-group'>
          <div class='mt-3 row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>ĐT di động:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail' style='color: #7749F8  '>
                {{employee.phone === null ? 'Chưa cập nhật' : employee.phone}}
            </span>
            </div>
          </div>
          <div class='row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Số ĐT khác:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail' style='color: #7749F8  '>
                {{employee.workPhone === null ? 'Chưa cập nhật' : employee.workPhone}}
            </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Email cá nhân:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail'>
                {{employee.email === null ? 'Chưa cập nhật' : employee?.email}}
            </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Facebook:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail'>
                {{employee?.facebook === null ? 'Chưa cập nhật' : employee.facebook}}
            </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>zalo:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail'>
                {{employee?.zalo === null ? 'Chưa cập nhật' : employee?.zalo}}
            </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-3 py-2 title-employee title-detail'>
              <span>Nguyên quán:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail'>
                {{employee.birthplace === null ? 'Chưa cập nhật' : employee.birthplace}}
            </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class='col-12'>
      <div class=' d-flex align-items-center'>
        <div class='ml-2 mt-5  d-flex align-items-center main-title'>Thông tin bảo hiểm
          <button
            *ngIf='!employee.leftAt'
            data-toggle='tooltip'
            data-placement='top'
            title=' chỉnh sửa '
            class='edit animated ml-5 not-print'
            (click)='addOrUpdateBHYT(employee.bhyt)'>
            <img style='height: 15px;' src='../../../../../assets/img/share/pencil-fill.svg' alt='edit icon'>
          </button>
        </div>

      </div>
      <div class='row pl-3 '>
        <div class='col-6  form-group'>
          <div class='mt-3 row align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Ngày tham gia BH:</span>
            </div>
            <div class='col-md-8 py-2'>
              <span class='contain-detail' *ngIf='employee?.bhyt === null'>
                 Chưa cập nhật
              </span>
              <span class='contain-detail' *ngIf='employee?.bhyt !==null'>
               {{employee.bhyt| date: 'dd/MM/yyyy'}}
            </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Tỉ lệ đóng bảo hiểm:</span>
            </div>
            <div class='col-md-8 py-2'>
                <span class='contain-detail'>
                {{employee?.bhyt === null ? 'Chưa có thông tin' : employee?.bhyt }}
                </span>

            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>số sổ BHXH:</span>
            </div>
            <div class='col-md-8 py-2'>
                <span class='contain-detail'>
                {{employee?.bhyt === null ? 'Chưa có thông tin' : employee?.bhyt }}
                </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Mã số BHXH:</span>
            </div>
            <div class='col-md-8 py-2'>
                <span class='contain-detail'>
                {{employee?.bhyt === null ? 'Chưa có thông tin' : employee?.bhyt
                  }}
                </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Mã tỉnh cấp:</span>
            </div>
            <div class='col-md-8 py-2'>
                <span class='contain-detail'>
                {{employee?.bhyt === null ? 'Chưa có thông tin' : employee?.bhyt }}
                </span>
            </div>
          </div>
        </div>
        <div class='col-6  form-group'>
          <div class='mt-3 row align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Số thẻ BHYT:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail'>
                {{employee?.bhyt === null ? 'Chưa cập nhật' : employee?.bhyt}}
            </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Ngày hết hạn:</span>
            </div>
            <div class='col-md-8 py-2'>
                <span *ngIf='employee?.bhyt === null'>
                  Chưa cập nhật
                </span>
              <span class='contain-detail'>
                    {{employee.bhyt|date:'dd/MM/yyyy'}}
                </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Nơi đăng kí KCB:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail'>
                {{employee?.bhyt === null ? 'Chưa cập nhật' : employee?.bhyt}}
            </span>
            </div>
          </div>
          <div class=' row align-items-center'>
            <div class='col-md-4 py-2 title-employee title-detail'>
              <span>Mã số nơi KCB:</span>
            </div>
            <div class='col-md-8 py-2'>
            <span class='contain-detail'>
                {{employee?.bhyt === null ? 'Chưa cập nhật' : employee?.bhyt }}
            </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class='col-12 mt-5'>
      <div class='row d-flex align-items-center '>
        <div class=' align-items-center title-table mr-4'>Thành phần gia đình</div>
        <div class='col-md-4 add not-print' *ngIf='!employee.leftAt' (click)='addAndUpdateRelative(employee.id )'>
          <span class='mr-1 font-weight-bold '>Thêm mục</span>
          <img style='margin-left: 2px;width: 10px;' src='../../../../../assets/img/payroll/plus-lg.svg'
               alt='add icon'>
        </div>
      </div>
      <div class='mt-3 '>
        <nz-table
          [nzData]="employee.relatives|| []"
          class='mt-3'>
          <thead>
          <tr>
            <th>Họ và tên</th>
            <th>Quan hệ</th>
            <th>Ngày sinh</th>
            <th>Số điện thoại</th>
            <th>Email</th>
            <th>Liên hệ khẩn cấp</th>
            <th>Xóa</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor='let relative of employee.relatives'>
            <td (click)='addAndUpdateRelative(employee.id, relative.id, relative)'>
              {{relative.lastName}}
            </td>
            <td>{{relative.relationship|transform: relationshipConstant}}</td>
            <td (click)='addAndUpdateRelative(employee.id, relative.id, relative)'
                class='text-center pointer'>{{relative.birthday |date:'dd/MM/yyyy'}}</td>
            <td (click)='addAndUpdateRelative(employee.id, relative.id, relative)'
                class='text-center pointer'>{{relative.phone ? relative.phone : 'Chưa cập nhật'}}</td>
            <td (click)='addAndUpdateRelative(employee.id, relative.id, relative)'
                class='text-center pointer'>{{relative.email ? relative.email : 'Chưa cập nhật'}}</td>
            <td (click)='addAndUpdateRelative(employee.id, relative.id, relative)'>
              <input style='margin-left: 50%' disabled type='checkbox' [checked]='relative.sos'>
            </td>
            <td class="not-print">
              <button
                style='margin-left: 35%'
                data-toggle='tooltip'
                data-placement='top'
                title='xóa'
                class=' trash '
                (click)='deleteRelative(relative.id , employee.id)'
              >
                <img style='height: 9px;' src='../../../../../assets/img/payroll/trash.svg' alt='delete icon'>
              </button>
            </td>
          </tr>
          </tbody>

        </nz-table>
      </div>
    </div>
    <div class='col-12 mt-5'>
      <div class='row'>
        <div class=' align-items-center title-table mr-4'>Trình độ bằng cấp</div>
        <div class='col-md-4 add not-print' *ngIf='!employee.leftAt' (click)='addAndUpdateDegree(employee.id)'>
          <span class='mr-1 font-weight-bold'>Thêm mục</span>
          <img style='margin-left: 2px;width: 10px;' src='../../../../../assets/img/payroll/plus-lg.svg'
               alt='add icon'>
        </div>
      </div>
      <div class='mt-3 '>
        <nz-table
          [nzData]="employee.degrees|| []"
          nzShowPagination="false"
          class='mt-3'>
          <thead>
          <tr>
            <th>Bằng cấp</th>
            <th>Bắt đầu</th>
            <th>Kết thúc</th>
            <th>Chuyên ngành</th>
            <th>hình thức đào tạo</th>
            <th>Nơi đào tạo</th>
            <th>Mức tốt nghiệp</th>
            <th>Tốt nghiệp</th>
            <th class='not-print'>Xóa</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor='let degree of employee.degrees'>
            <td (click)='addAndUpdateDegree(employee.id,degree.id , degree)'>
              {{degree.type|transform:degreeConstant }}
            </td>
            <td class='text-center pointer'
                (click)='addAndUpdateDegree(employee.id,degree.id , degree)'
            >{{degree.startedAt |date:'dd/MM/yyyy'}}</td>
            <td class='text-center pointer'
                (click)='addAndUpdateDegree(employee.id,degree.id , degree)'
            >{{degree.endedAt |date:'dd/MM/yyyy'}}</td>
            <td class='text-center pointer'
                (click)='addAndUpdateDegree(employee.id,degree.id , degree)'
            >{{degree.major}}</td>
            <td class='text-center pointer'
                (click)='addAndUpdateDegree(employee.id,degree.id , degree)'>
              {{degree.formality|transform: formalityTypeConstant}}
            </td>
            <td class='text-center pointer'
                (click)='addAndUpdateDegree(employee.id,degree.id , degree)'
            >{{degree.school}}</td>
            <td class='text-center pointer'
                (click)='addAndUpdateDegree(employee.id,degree.id , degree)'>
              {{degree.level|transform:degreeLevelTypeConstant}}
            </td>
            <td class='text-center pointer'
                (click)='addAndUpdateDegree(employee.id,degree.id , degree)'>
              {{degree.status|transform: degreeStatusTypeConstant}}
            </td>
            <td class="not-print">
              <button
                style='margin-left: 35%'
                data-toggle='tooltip'
                data-placement='top'
                title='xóa'
                class=' trash '
                (click)='deleteDegree(degree.id , employee.id)'
              >
                <img style='height: 9px;' src='../../../../../assets/img/payroll/trash.svg' alt='delete icon'>
              </button>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </div>
    </div>
    <div class='col-12'>
      <div class=' mt-5 mb-3 row align-items-center title-table'>Lịch sử lương</div>
      <div>
        <nz-table
          [nzScroll]="{x: '300px', y:'100%'}"
          [nzData]="employee.salaryHistories|| []"
        >
          <thead>
          <tr>
            <th>Loại lương</th>
            <th>Mức lương</th>
            <th>Ngày</th>
            <th>Hành động</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor='let history of employee.salaryHistories|filterDay'>
            <td>{{history?.title}}</td>
            <td>{{history?.price ? (history.price|number:'1.0') : ''}}đ</td>
            <td>{{history?.createdAt|date:'dd/MM/yyyy'}}</td>
            <td>
              <div class="text-center">
                <button class="btn btn-danger" (click)="deleteHistorySalary(history)">Xoá</button>
              </div>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </div>
    </div>
    <div class='col-12 mb-3'>
      <div class=' mt-5 mb-3 row align-items-center title-table'>Lịch sử công tác</div>
      <div>
        <nz-table
          #tableWorkHistory
          [nzScroll]="{x: '300px', y:'100%'}"
          [nzData]="employee.workHistories|| []">
          <thead>
          <tr>
            <th>Từ ngày</th>
            <th>Vị trí công việc</th>
            <th>Đơn vị công tác</th>
            <th>Xoá</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor='let workHistory of tableWorkHistory.data|workhistorypipe'>
            <td>{{workHistory?.createdAt|date:'dd/MM/yyyy'}}</td>
            <td>{{workHistory?.position?.name}}</td>
            <td>{{workHistory?.branch?.name}}</td>
            <td (click)="deleteWorkHistory(workHistory, employee.id)">
              <button nz-button nzType="dashed">
                Xoá
              </button>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </div>
    </div>
  </div>
</div>

<style>
  @media print {
    .show-table-print {
      height: auto !important;
      overflow: auto !important;
    }
  }
</style>
